<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expiry Date</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <!-- <script src="https://unpkg.com/@barba/core"></script> -->
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
    rel="stylesheet"
/>
    <style>
        .tab-link{
  user-select: none;
}

    </style>

</head>
<body data-barba="wrapper">
    <!-- <div class="loader">
        <div class="page-transition"></div>
    </div> -->
    
    <div class="main" data-barba="container" data-barba-namespace="home-section">
        <div class="page1">
            <div class="container" style="margin-bottom: 4rem;">

                <div class="nav">
                    <div class="logo">
                        <a href = "home.html"> <img src="Imgs/Logo.svg" alt=""> </a> 
                    </div>
                    <div class="icon" id="icon">
                        <div id="login"><img src="Imgs/pfp.svg" ID="pfp" alt=""></div>
                    </div>
                </div>

                <div class="search-bar">
                    <div class="group">
                        <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.79007 15.27L8.52007 11.86C8.62635 11.3861 8.86574 10.9525 9.21007 10.61L15.8801 3.99999C16.5565 3.31097 17.4748 2.91277 18.4401 2.88999C19.1681 2.87956 19.8701 3.16036 20.3901 3.66999C21.5263 5.01246 21.3796 7.01721 20.0601 8.17999L13.3901 14.85C13.0476 15.1943 12.6139 15.4337 12.1401 15.54L8.73007 16.27H8.54007C8.29078 16.2795 8.05268 16.1661 7.903 15.9665C7.75332 15.767 7.71111 15.5066 7.79007 15.27ZM10.2701 11.68C10.13 11.8158 10.0326 11.9896 9.99007 12.18L9.50007 14.51L11.8301 14.01C12.0205 13.9674 12.1943 13.8701 12.3301 13.73L19.0001 7.05999C19.7308 6.47501 19.8758 5.42047 19.3301 4.65999C19.0911 4.4317 18.7704 4.30916 18.4401 4.31999C17.8706 4.34286 17.3326 4.58679 16.9401 4.99999L10.2701 11.68Z" fill="#8D8D8D"/>
                            <path d="M19.9101 10.93C19.4981 10.9354 19.1655 11.268 19.1601 11.68V17.37C19.1735 18.1743 18.8633 18.9502 18.2993 19.5237C17.7352 20.0972 16.9645 20.4201 16.1601 20.42H6.63008C4.96745 20.3874 3.63519 19.0329 3.63008 17.37V7.87999C3.65738 6.21508 5.01494 4.87977 6.68008 4.87999H12.3701C12.7843 4.87999 13.1201 4.5442 13.1201 4.12999C13.1201 3.71578 12.7843 3.37999 12.3701 3.37999H6.63008C4.13658 3.37984 2.10748 5.38664 2.08008 7.87999V17.37C2.08008 19.8829 4.11718 21.92 6.63008 21.92H16.1201C18.6291 21.9145 20.6601 19.879 20.6601 17.37V11.68C20.6547 11.268 20.322 10.9354 19.9101 10.93Z" fill="#8D8D8D"/>
                            </svg>
                            
                            
                        <input id="meds" class="input" type="text" placeholder="Ex. Medicine Name" />
                    </div>           
                </div>
                <div class="inputbox">
                    <div class="group">
                        <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8.65 7.59C8.35449 7.31464 7.89399 7.32277 7.60838 7.60838C7.32277 7.89399 7.31464 8.35449 7.59 8.65L11.37 12.43V17.12C11.37 17.5342 11.7058 17.87 12.12 17.87C12.5342 17.87 12.87 17.5342 12.87 17.12V12.12C12.8698 11.9212 12.7907 11.7305 12.65 11.59L8.65 7.59Z" fill="#8D8D8D"/>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M10 2H14.24C16.3617 2 18.3966 2.84285 19.8969 4.34315C21.3971 5.84344 22.24 7.87827 22.24 10V14.24C22.24 18.6583 18.6583 22.24 14.24 22.24H10C5.58172 22.24 2 18.6583 2 14.24V10C2 5.58172 5.58172 2 10 2ZM14.24 20.74C17.8276 20.7345 20.7345 17.8276 20.74 14.24V10C20.7345 6.41243 17.8276 3.50551 14.24 3.5H10C6.41243 3.50551 3.50551 6.41243 3.5 10V14.24C3.50551 17.8276 6.41243 20.7345 10 20.74H14.24Z" fill="#8D8D8D"/>
                            </svg>
                            
                            
                        <input type="date" name="date" class="input" id="med_date">
                    </div>       
                </div>
                <div class="buttonns">
                    <div class="group">
                            
                            <button id="btn" class="input"> Add </button>
                            <button id="clrbtn" class="input"> Clear </button>
                    </div>       
                </div>

                <h3 class="titl">Medicines List: </h3>
    
    <ul id="list">

        <li>

        </li>

    </ul>

    <div class="bottom-nav">
        <div class="tabs">
            <div class="tab">
                <a class="tab-link" href="home.html"><i class="ri-home-5-line tab-icon"></i></a>
            </div>
            <div class="tab">
                <a class="tab-link" href="search.html"><i class="ri-medicine-bottle-line tab-icon"></i></a>
            </div>
            <div class="tab">
                <a class="tab-link" href="home_remedies.html"><i class="ri-hospital-line  tab-icon"></i></a>
            </div>
            <div class="tab">
                <a class="tab-link medkit" href="medkit.html"><i class="ri-first-aid-kit-line tab-icon"></i></a>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script> 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
<script type="module" src="auth.js"></script>
<script src="search.js"></script>
<!-- <script src="barba.js"></script> -->

    <script>

        let index = 0;
        let btn_class = "";
        let expiry_status = ""; 
        const ul = document.getElementById('list');

        let arr;

        if (localStorage.getItem('arr')) {
            arr = JSON.parse(localStorage.getItem('arr'));
        } else {
            arr = [];
        }

        let clearbtn = document.getElementById("clrbtn");
        let med_name = document.getElementById("meds");
        let med_date = document.getElementById("med_date");
        let btn = document.getElementById("btn")

        let date = new Date();
        let dd = date.getDate();
        let mm = date.getMonth();
        let yy = date.getFullYear();
        console.log(dd + " " +  mm + " " + yy );

        function compare(expiry_date){

            let day = expiry_date.getDate();
            let month = expiry_date.getMonth();
            let year = expiry_date.getFullYear();
            console.log(day + " " +  month + " " + year );

            if(year === yy){
                if(month === mm){
                    if(day === dd){
                        // alert("You Ded Today!");
                        expiry_status = "Not Expired";
                    }else if( day < dd){
                        // alert("Expired! Ded Days");
                        expiry_status = "Expired";
                    }else if( day > dd){
                        // alert("Days Remaining, You Safe!");
                        expiry_status = "Not Expired";
                    }
                }else if(month > mm){
                    // alert("Months Remaining, You Safe!")
                    expiry_status = "Not Expired";
                }else if(month < mm){
                    // alert("Expired! Ded Month");
                    expiry_status = "Expired";
                }
            }else if(year < yy){
                // alert("Expired!, You ded");
                expiry_status = "Expired";
            }else if(year > yy){
                // alert("You Still have a lot time!")
                expiry_status = "Not Expired";
            }
        }

        function add(name, exdate){
            arr.push({med: name, date: exdate});
            // alert(name);
            // alert(exdate);
        }

        function display() {

            ul.innerHTML = "";
            arr.forEach(obj => {
                const li = document.createElement('li');
                let expiridate = new Date(obj.date);
                compare(expiridate);

            
                if(expiry_status.toLowerCase() === "expired"){
                    btn_class = "red";
                }else{
                    btn_class = "green";
                }
                li.innerHTML = `<div class="flx"> <div classname="  ">${obj.med} <br> <small style="color: rgb(0,0,0,0.4);">${obj.date}</small> </div> <button class="${btn_class}" id="${index}" onclick="handleClick(${index})">${expiry_status}</button> </div>`;
                ul.appendChild(li);
                index = index + 1;
            });
        }

        function handleClick(index){
            deleteElement(index);
            display();
            location.reload();
        }

        function deleteElement(index) {
            if (localStorage.getItem('arr')) {
                // Get the array from local storage 
                let arr = JSON.parse(localStorage.getItem('arr'));
                
                // Remove the element at the specified index
                arr.splice(index, 1);
                
                // Update the local storage with the modified array
                localStorage.setItem('arr', JSON.stringify(arr));
                
                // Optionally, you can perform any other actions needed after deletion
                
                // For example, you might want to refresh the UI to reflect the changes
                // Or update some other part of your application
                
                // For now, let's log the updated array to the console
                console.log('Element deleted. Updated array:', arr);
            } else {
                console.error('Array not found in local storage.');
            }
        }


        function clear(){
            console.log(arr);
            med_name.value = "";
            med_date.value = "";
        }


        function click() {
            if (med_name.value && med_date.value) {
                add(med_name.value, med_date.value);
            }else{
                alert("Enter Valid Details!")
            }
            clear();
            display();
        }

        btn.addEventListener("click", function(){
            click();
            localStorage.setItem('arr', JSON.stringify(arr));
            let data = JSON.parse(
                localStorage.getItem('arr'),
            );
            console.log(data)

        })

        clearbtn.addEventListener("click", function(){
            localStorage.clear();
        })

        document.addEventListener("DOMContentLoaded", function() {
            display();
        });
        
    </script>
    
</body>
</html>